FROM debian:bookworm-slim

ARG RUNNER_VERSION=2.331.0
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y --no-install-recommends \
    curl jq build-essential libssl-dev libffi-dev python3 python3-venv python3-dev python3-pip \
    bash \
    && rm -rf /var/lib/apt/lists/*

RUN useradd -m docker

RUN mkdir -p /home/docker/actions-runner \
    && curl -L -o /home/docker/actions-runner/runner.tar.gz \
       https://github.com/actions/runner/releases/download/v${RUNNER_VERSION}/actions-runner-linux-x64-${RUNNER_VERSION}.tar.gz \
    && tar xzf /home/docker/actions-runner/runner.tar.gz -C /home/docker/actions-runner \
    && rm /home/docker/actions-runner/runner.tar.gz

RUN /home/docker/actions-runner/bin/installdependencies.sh

COPY ./start.sh /home/docker/start.sh
RUN chmod +x /home/docker/start.sh \
    && chown -R docker:docker /home/docker

WORKDIR /home/docker
USER docker
ENTRYPOINT ["./start.sh"]